---
title: "HypothesisTest"
author: "Mary Solomon"
date: "2/19/2021"
output: 
  html_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(lubridate) #for working with time stamps :D
library(tidyverse)
library(ggplot2)
library(ggthemes)
library(stringr)
library(scales) #for formatting with percentage signs
library(nnet) #for multinomial regression
library(caret)
library(car) #for vif function and boxcox transformation
```


Load the data:
```{r}
data <- fread("kpopdata.csv")
data <- mutate(data, ArtistType = as.factor(ArtistType),
               ArtistGender = as.factor(ArtistGender),
               ArtistGen = factor(ArtistGen),
               release_date = as.POSIXct(release_date, format = "%m/%d/%y"),
               key = factor(key, levels = 0:11),
               mode = as.factor(mode),
               time_signature = factor(time_signature, levels = c(1,3,4,5)))
colnames(data)
```



For this section, we are going to perform hypothesis tests to compare audio features based on different groups. We will do so one audio feature at a time based on attributes such as Artist Gen, Artist Gender, Artist Type.

First let's see the breakdown of number of observations in each gorup.
```{r}
#songs per kpop generation
table(data$ArtistGen)/nrow(data)
#songs per gender of artist
table(data$ArtistGender)/nrow(data)
#songs per Artist Type (group v solo)
table(data$ArtistType)/nrow(data)
```

Breakdown of proportions of observations in each group
```{r}
#songs per kpop generation
round(table(data$ArtistGen)/nrow(data),3)
#songs per gender of artist
round(table(data$ArtistGender)/nrow(data),3)
#songs per Artist Type (group v solo)
round(table(data$ArtistType)/nrow(data), 3)
```

The groups are in very unequal balance making a very uneven comparison. The Kruskal Wallis and Mann Whitney Wilcoxon tests are robust to uneven group sizes. As long as there is a large enough sample in each group, it is okay to have uneven group sizes. While 4th generation and soloists make up a much smaller proportion of the data in their attribute comparisons, the sample sizes are both large enough. However, for the case of coed artists, there are only 12 songs in the entire dataset, making the sample size too small for analysis. 


```
#1 is old gen 0 is new generation
data$oldgen <- as.factor(ifelse(data$ArtistGen == 1 | data$ArtistGen == 2, 1, 0))
# 1 is boy groups and 2 is girl groups, 0 is all others.
data$bg <- as.factor(ifelse(data$ArtistType == "group" & data$ArtistGender == "male", 1, 
                            ifelse(data$ArtistType == "group" & data$ArtistGender == "female", 2, 0)))
```

```
# songs per old vs new gen
round(table(data$oldgen)/nrow(data),3)
# songs per boygroup/girlgroup
round(table(data$bg)/nrow(data),3)
```


# Hypothesis testing across kpop generations
```{r}
## all generations
gen1 <- filter(data, ArtistGen == 1)
gen2 <- filter(data, ArtistGen == 2)
gen3 <- filter(data, ArtistGen == 3)
gen4 <- filter(data, ArtistGen == 4)

# ## Reducing the groups
# oldgen <- filter(data, oldgen == 1)
# newgen <- filter(data, oldgen == 0)
```


### Popularity Difference by Generations

All four gens
```{r}
kruskal.test(list(gen1$popularity, gen2$popularity, gen3$popularity, gen4$popularity))
```

Reduced to two generations
```
wilcox.test(oldgen$popularity, newgen$popularity, paired = FALSE, alternative = "two.sided")
```

### Duration Difference by Generations

All four gens
```{r}
kruskal.test(list(gen1$duration, gen2$duration, gen3$duration, gen4$duration))
```

Reduced to two generations
```
wilcox.test(oldgen$duration, newgen$duration, paired = FALSE, alternative = "two.sided")
```

### Acousticness Difference by Generations

All four gens
```{r}
kruskal.test(list(gen1$acousticness, gen2$acousticness, gen3$acousticness, gen4$acousticness))
```

Reduced to two generations
```
wilcox.test(oldgen$acousticness, newgen$acousticness, paired = FALSE, alternative = "two.sided")
```



### Danceability Difference by Generations

All four gens
```{r}
kruskal.test(list(gen1$danceability, gen2$danceability, gen3$danceability, gen4$danceability))
```

Reduced to two generations
```
wilcox.test(oldgen$danceability, newgen$danceability, paired = FALSE, alternative = "two.sided")
```



### Energy Difference by Generations

All four gens
```{r}
kruskal.test(list(gen1$energy, gen2$energy, gen3$energy, gen4$energy))
```

Reduced to two generations
```
wilcox.test(oldgen$energy, newgen$energy, paired = FALSE, alternative = "two.sided")
```


### Instrumentalness Difference by Generations

All four gens
```{r}
kruskal.test(list(gen1$instrumentalness, gen2$instrumentalness, gen3$instrumentalness, gen4$instrumentalness))
```

Reduced to two generations
```
wilcox.test(oldgen$instrumentalness, newgen$instrumentalness, paired = FALSE, alternative = "two.sided")
```


### Speechiness Difference by Generations

All four gens
```{r}
kruskal.test(list(gen1$speechiness, gen2$speechiness, gen3$speechiness, gen4$speechiness))
```

Reduced to two generations
```
wilcox.test(oldgen$speechiness, newgen$speechiness, paired = FALSE, alternative = "two.sided")
```


### Speechiness Difference by Generations

All four gens
```{r}
kruskal.test(list(gen1$speechiness, gen2$speechiness, gen3$speechiness, gen4$speechiness))
```

Reduced to two generations
```
wilcox.test(oldgen$speechiness, newgen$speechiness, paired = FALSE, alternative = "two.sided")
```



### Loudness Difference by Generations

All four gens
```{r}
kruskal.test(list(gen1$loudness, gen2$loudness, gen3$loudness, gen4$loudness))
```

Reduced to two generations
```
wilcox.test(oldgen$loudness, newgen$loudness, paired = FALSE, alternative = "two.sided")
```


### Tempo Difference by Generations

All four gens
```{r}
kruskal.test(list(gen1$tempo, gen2$tempo, gen3$tempo, gen4$tempo))
```

Reduced to two generations
```
wilcox.test(oldgen$tempo, newgen$tempo, paired = FALSE, alternative = "two.sided")
```


### Valence Difference by Generations

All four gens
```{r}
kruskal.test(list(gen1$valence, gen2$valence, gen3$valence, gen4$valence))
```

Reduced to two generations
```
wilcox.test(oldgen$valence, newgen$valence, paired = FALSE, alternative = "two.sided")
```



# Hypothesis comparing male/female/coed kpop artists
```{r}
#coed <- filter(data, ArtistGender == "coed")
female <- filter(data, ArtistGender == "female")
male <- filter(data, ArtistGender == "male")
```

### Popularity Difference by Artist Gender

```{r}
wilcox.test(female$popularity, male$popularity, paired = FALSE, alternative = "two.sided")
```



### Duration Difference by Artist Gender

```{r}
wilcox.test(female$duration, male$duration, paired = FALSE, alternative = "two.sided")
```


### Acousticness Difference by Artist Gender

```{r}
wilcox.test(female$acousticness, male$acousticness, paired = FALSE, alternative = "two.sided")
```


### Danceability Difference by Artist Gender

```{r}
wilcox.test(female$danceability, male$danceability, paired = FALSE, alternative = "two.sided")
```


### Energy Difference by Artist Gender

```{r}
wilcox.test(female$energy, male$energy, paired = FALSE, alternative = "two.sided")
```

### Instrumentalness Difference by Artist Gender

```{r}
wilcox.test(female$instrumentalness, male$instrumentalness, paired = FALSE, alternative = "two.sided")
```


### Speechiness Difference by Artist Gender

```{r}
wilcox.test(female$speechiness, male$speechiness, paired = FALSE, alternative = "two.sided")
```


### Loudness Difference by Artist Gender

```{r}
wilcox.test(female$loudness, male$loudness, paired = FALSE, alternative = "two.sided")
```



### Tempo Difference by Artist Gender

```{r}
wilcox.test(female$tempo, male$tempo, paired = FALSE, alternative = "two.sided")
```



### Valence Difference by Artist Gender

```{r}
wilcox.test(female$valence, male$valence, paired = FALSE, alternative = "two.sided")
```


# Hypothesis testing between Kpop Artist types (group or solo)
```{r}
## Reducing the groups
group <- filter(data, ArtistType == "group")
solo <- filter(data, ArtistType == "solo")
```


### Popularity Difference by Artist Type

```{r}
wilcox.test(group$popularity, solo$popularity, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```

### Duration Difference by Artist Type

```{r}
wilcox.test(group$duration, solo$duration, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```


### Acousticness Difference by Artist Type

```{r}
wilcox.test(group$acousticness, solo$acousticness, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```



### Danceability Difference by Artist Type

```{r}
wilcox.test(group$danceability, solo$danceability, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```


### Energy Difference by Artist Type

```{r}
wilcox.test(group$energy, solo$energy, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```


### Instrumentalness Difference by Artist Type

```{r}
wilcox.test(group$instrumentalness, solo$instrumentalness, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```


### Speechiness Difference by Artist Type

```{r}
wilcox.test(group$speechiness, solo$speechiness, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```


### Loudness Difference by Artist Type

```{r}
wilcox.test(group$loudness, solo$loudness, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```


### Tempo Difference by Artist Type

```{r}
wilcox.test(group$tempo, solo$tempo, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```


### Valence Difference by Artist Type

```{r}
wilcox.test(group$valence, solo$valence, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```




# Hypothesis testing between Kpop Group types (Girl Group vs Boy Group)

This grouping is used since the balance between categories of groups and soloists are VERY uneven. In the kpop industry groups are dominant in the genre. 

```{r}
## Reducing the groups
boy.group <- filter(data, ArtistType == "group" & ArtistGender == "male")
girl.group <- filter(data, ArtistType == "group" & ArtistGender == "female")
```


### Popularity Difference by Group Type

```{r}
wilcox.test(boy.group$popularity, girl.group$popularity, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```

### Duration Difference by Group Type

```{r}
wilcox.test(boy.group$duration, girl.group$duration, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```


### Acousticness Difference by Group Type

```{r}
wilcox.test(boy.group$acousticness, girl.group$acousticness, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```



### Danceability Difference by Group Type

```{r}
wilcox.test(boy.group$danceability, girl.group$danceability, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```


### Energy Difference by Group Type

```{r}
wilcox.test(boy.group$energy, girl.group$energy, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```


### Instrumentalness Difference by Group Type

```{r}
wilcox.test(boy.group$instrumentalness, girl.group$instrumentalness, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```


### Speechiness Difference by Group Type

```{r}
wilcox.test(boy.group$speechiness, girl.group$speechiness, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```


### Loudness Difference by Group Type

```{r}
wilcox.test(boy.group$loudness, girl.group$loudness, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```


### Tempo Difference by Group Type

```{r}
wilcox.test(boy.group$tempo, girl.group$tempo, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```


### Valence Difference by Group Type

```{r}
wilcox.test(boy.group$valence, girl.group$valence, paired = FALSE, alternative = "two.sided", conf.int = TRUE, conf.level = 0.95)
```